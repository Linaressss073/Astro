---
const { search } = Astro.url;
const params = new URLSearchParams(search);

const reservaId = params.get("reservaId");

const procesarPago = async () => {
  const token = localStorage.getItem("token");
  if (!token) {
    alert("‚ö†Ô∏è Debes iniciar sesi√≥n.");
    window.location.href = "/login";
    return;
  }

  try {
    const response = await fetch("http://localhost:3001/api/payment", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        Authorization: `Bearer ${token}`,
      },
      body: JSON.stringify({
        reservaId,
        name: "Cliente Ejemplo",
        number: "4111111111111111",
        expiry: "12/26",
        cvv: "123",
        amount: 250,
      }),
    });

    const data = await response.json();

    if (!response.ok) {
      alert(`‚ùå Error en el pago: ${data.message}`);
      return;
    }

    alert("‚úÖ ¬°Pago exitoso!");
    window.location.href = "/exito";
  } catch (error) {
    alert("‚ùå Error en el servidor. Intenta m√°s tarde.");
    console.error("Error en el pago:", error);
  }
};
---

<style>
  .pago-container {
    max-width: 600px;
    margin: 40px auto;
    padding: 20px;
    border: 2px solid #2A0A60;
    border-radius: 16px;
    background: #FAF9FF;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  h2 {
    text-align: center;
    color: #2A0A60;
    margin-bottom: 24px;
  }

  .pay-btn {
    width: 100%;
    padding: 12px;
    background: #5A32A3;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 18px;
    cursor: pointer;
    transition: background 0.3s;
  }

  .pay-btn:hover {
    background: #2A0A60;
  }
</style>

<div class="pago-container">
  <h2>Simular Pago üí≥</h2>

  <p>üßæ Est√°s a punto de pagar tu reserva.</p>

  <button class="pay-btn" onClick={procesarPago}>Pagar Ahora</button>
</div>
